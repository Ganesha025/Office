<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Travel Expense Form</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<style>
body{font-family:'Inter',sans-serif;background:#f0f2f5;margin:0;padding:20px}
.container{max-width:900px;margin:auto;background:#fff;padding:30px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.1)}
h2{text-align:center;margin-bottom:30px;color:#333}
form{display:grid;grid-template-columns:1fr 1fr;gap:20px 40px}
form>div{display:flex;flex-direction:column}
label{font-weight:500;margin-bottom:6px}
input,select,textarea{padding:10px 12px;border-radius:6px;border:1px solid #ccc;font-size:14px;transition:border-color .3s}
input:focus,select:focus,textarea:focus{border-color:#007bff;outline:none}
textarea{resize:vertical}
.error{color:#d93025;font-size:13px;margin-top:4px;display:none;}
.full-width{grid-column:span 2}
.checkbox-label{display:flex;align-items:center}
.checkbox-label input{width:auto;margin-right:10px}
button{grid-column:span 2;padding:12px;font-size:16px;border-radius:6px;border:none;background:#007bff;color:#fff;cursor:pointer}
button:hover{background:#0056b3}
#changePasswordForm{display:none;grid-column:span 2;gap:10px}
@media(max-width:768px){form{grid-template-columns:1fr}.full-width{grid-column:span 1}}
</style>
</head>
<body>
   <!-- // Bootstrap Toast for Password Update  -->

<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1055">
  <div id="passwordToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">
        Password updated successfully!
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>

   <!-- Toast for Form Submission  -->
  <div id="formToast" class="toast align-items-center text-bg-primary border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">
        Travel expense form submitted successfully!
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>

<div class="container">
<h2>Travel Expense Form</h2>
<form id="travelForm" novalidate>

<div><label>Employee Code *</label><input type="text" id="empCode" placeholder="EMP1234" maxlength="10"><div class="error" id="empCodeError"></div></div>

<div><label>Department *</label><select id="department"><option>Choose Department</option><option>HR</option><option>Finance</option><option>IT</option><option>Marketing</option></select><div class="error" id="departmentError"></div></div>

<div><label>Travel Date *</label><input type="date" id="travelDate"><div class="error" id="travelDateError"></div></div>

<div><label>Travel Purpose *</label><textarea id="travelPurpose" rows="4" placeholder="Enter purpose" maxlength="250"></textarea><div class="error" id="travelPurposeError"></div></div>

<div><label>Travel Mode *</label><select id="travelMode"><option value="">Select Travel Mode</option><option value="car">Car</option><option value="train">Train</option><option value="flight">Flight</option></select><div class="error" id="travelModeError"></div></div>

<div><label id="ticketLabel" style="display:none">Flight Ticket Number *</label><input type="text" id="ticketNumber" placeholder="TK12345678" style="display:none" maxlength="10"><div class="error" id="ticketError"></div></div>

<div><label>Distance (KM) *</label><input type="number" id="distance" min="1" max="2000"><div class="error" id="distanceError"></div></div>

<div><label>Expense Amount (â‚¹) *</label><input type="number" id="expenseAmount" min="100" max="50000"><div class="error" id="expenseAmountError"></div></div>

<div><label id="billLabel" style="display:none">Upload Bill *</label><input type="file" id="billUpload" style="display:none"><div class="error" id="billError"></div></div>

<div class="full-width checkbox-label"><input type="checkbox" id="declaration"><label>I confirm the above details are accurate</label><div class="error" id="declarationError"></div></div>

<div class="full-width"><a href="#" id="changePassLink">Change Password</a></div>
<div id="changePasswordForm">
<input type="password" id="currentPassword" placeholder="Current Password">
<div class="error" id="currentPasswordError"></div>
<input type="password" id="newPassword" placeholder="New Password">
<div class="error" id="newPasswordError"></div>
<input type="password" id="confirmPassword" placeholder="Confirm New Password">
<div class="error" id="confirmPasswordError"></div>
<button type="button" id="updatePassword">Update Password</button>
</div>
<button type="submit">Submit</button>

</form>
</div>

<script>
$(document).ready(function(){
    // Focus
    $('#empCode').focus();

    function showToast(toastId){
        let toastEl = document.getElementById(toastId);
        let toast = new bootstrap.Toast(toastEl);
        toast.show();
    }

    // Employee Code live validation
    $("#empCode").on("input", function() {
        this.value = this.value.replace(/[^a-zA-Z0-9]/g,'').substring(0,10);
        let val = $(this).val();
        if(!/^EMP[0-9]{0,7}$/.test(val)) $("#empCodeError").text('Must start with EMP + numbers, max 10 chars').show();
        else $("#empCodeError").hide();
    });

    // Travel Date constraints
    let today = new Date();
    let thirtyDaysAgo = new Date();
    thirtyDaysAgo.setDate(today.getDate() - 30);
    function formatDate(d){let month = '' + (d.getMonth() + 1); let day = '' + d.getDate(); let year = d.getFullYear(); if(month.length<2) month='0'+month; if(day.length<2) day='0'+day; return [year,month,day].join('-');}
    $("#travelDate").attr({"max": formatDate(today),"min": formatDate(thirtyDaysAgo)});

    $("#travelPurpose").on("input", function(){
        let val = $(this).val();
        if(val.length>250) $(this).val(val.substring(0,250));
        if(val.length>0 && val.length<20) $("#travelPurposeError").text('Min 20 chars').show();
        else if(/^\d+$/.test(val.trim())) $("#travelPurposeError").text('Cannot be numbers only').show();
        else $("#travelPurposeError").hide();
    });

    // Travel Mode change
    $("#travelMode").change(function(){
        if($(this).val()=="flight"){
            $("#ticketNumber,#ticketLabel").show();
        }else{
            $("#ticketNumber,#ticketLabel").hide();
            $("#ticketNumber").val('');
            $("#ticketError").hide();
        }
    });

    // Distance live constraint
    $("#distance").on("input", function(){
        let val = Number($(this).val());
        if(val > 2000) $(this).val(2000);
        if(val<1 || val>2000) $("#distanceError").text('1-2000 KM').show();
        else $("#distanceError").hide();
    });

    // Expense Amount live constraint
    $("#expenseAmount").on("input", function(){
        let val = Number($(this).val());
        if(val > 50000) $(this).val(50000);
        if(val<100 || val>50000) $("#expenseAmountError").text('100-50000').show();
        else $("#expenseAmountError").hide();

        if(val>10000) $("#billUpload,#billLabel").show();
        else { $("#billUpload,#billLabel").hide().val(''); $("#billError").hide(); }
    });

    // Change password toggle
    $("#changePassLink").click(function(e){e.preventDefault();$("#changePasswordForm").slideToggle()})

    $("#updatePassword").click(function(){
        let cur=$("#currentPassword").val(),
            newP=$("#newPassword").val(),
            conf=$("#confirmPassword").val(),
            valid=true;

        $(".error").text('').hide();
        if(!cur){$("#currentPasswordError").text('Required').show(); valid=false;}
        if(!newP){$("#newPasswordError").text('Required').show(); valid=false;}
        if(!conf){$("#confirmPasswordError").text('Required').show(); valid=false;}
        if(newP && conf && newP!==conf){$("#confirmPasswordError").text('Passwords do not match').show(); valid=false;}
        if(valid){
            showToast('passwordToast');
            $("#changePasswordForm").slideUp().find("input").val('')
        }
    });

    // Ticket Number live format
    $("#ticketNumber").on("input", function(){
        let val = this.value.toUpperCase();
        if(!val.startsWith("TK")) val="TK";
        val = val.substring(0,10).replace(/[^0-9TK]/g,'');
        this.value = val;
        if(!/^TK\d{0,8}$/.test(val)) $("#ticketError").text('Format TK########').show();
        else $("#ticketError").hide();
    });

    // Form submit validation
    $("#travelForm").submit(function(e){
        e.preventDefault();

        let emp=$("#empCode").val(),
            dept=$("#department").val(),
            date=$("#travelDate").val(),
            purpose=$("#travelPurpose").val(),
            mode=$("#travelMode").val(),
            ticket=$("#ticketNumber").val(),
            dist=$("#distance").val(),
            amt=$("#expenseAmount").val(),
            bill=$("#billUpload").val(),
            decl=$("#declaration").prop("checked"),
            valid=true;

        $(".error").text('').hide();

        if(!emp){$("#empCodeError").text('Required').show(); valid=false;}
        else if(!/^EMP[0-9]{0,7}$/.test(emp)){$("#empCodeError").text('Must start with EMP + numbers, max 10 chars').show(); valid=false;}

        if(dept=="Choose Department"){$("#departmentError").text('Select a department').show(); valid=false;}

        if(!date){$("#travelDateError").text('Required').show(); valid=false;}
        else{
            let selDate=new Date(date);
            if(selDate>today){$("#travelDateError").text('Cannot be a future date').show(); valid=false;}
            if(selDate<thirtyDaysAgo){$("#travelDateError").text('Cannot be older than 30 days').show(); valid=false;}
        }

        if(!purpose){$("#travelPurposeError").text('Required').show(); valid=false;}
        else if(purpose.length<20){$("#travelPurposeError").text('Min 20 chars').show(); valid=false;}
        else if(/^\d+$/.test(purpose.trim())){$("#travelPurposeError").text('Cannot be numbers only').show(); valid=false;}
        else if(purpose.length>250){$("#travelPurposeError").text('Max 250 chars').show(); valid=false;}

        if(!mode){$("#travelModeError").text('Required').show(); valid=false;}

        if(mode=="flight"){
            if(!ticket){$("#ticketError").text('Required').show(); valid=false;}
            else if(!/^TK\d{8}$/.test(ticket)){$("#ticketError").text('Format TK########').show(); valid=false;}
        }

        if(!dist || dist<1 || dist>2000){$("#distanceError").text('1-2000 KM').show(); valid=false;}

        if(!amt || amt<100 || amt>50000){$("#expenseAmountError").text('100-50000').show(); valid=false;}
        if(Number(amt)>10000 && !bill){$("#billError").text('Bill required').show(); valid=false;}

        if(!decl){$("#declarationError").text('Must confirm').show(); valid=false;}

        if(valid){
            showToast('formToast'); // Show the form submission toast
            $(this).trigger("reset");
            $("#ticketNumber,#ticketLabel,#billUpload,#billLabel").hide();
        }
    });
});
</script>
</body>
</html>
