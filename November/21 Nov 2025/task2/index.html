<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pollution Control Board - Vehicle Emission Registration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="../common.css">
    <style>
        .Button-disabled {
            background-color: #3b82f6; 
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="max-w-4xl mx-auto py-8 px-4">
        <div class="bg-white rounded-2xl shadow-lg p-8">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Vehicle Emission Registration</h1>
                <p class="text-gray-600">Pollution Control Board - Environmental Protection Initiative</p>
            </div>

            <form id="emissionForm" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Vehicle Owner Name</label>
                        <input type="text" name="ownerName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" >
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Vehicle Number</label>
                        <input type="text" name="vehicleNumber" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" >
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Registration Date</label>
                       <input type="date" name="registrationDate" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" id="registrationDate">
</div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Fuel Type</label>
                        <select name="fuelType" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                            <option value="">Select Fuel Type</option>
                            <option value="petrol">Petrol</option>
                            <option value="diesel">Diesel</option>
                            <option value="cng">CNG</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Vehicle Type</label>
                        <select name="vehicleType" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                            <option value="">Select Vehicle Type</option>
                            <option value="2w">2W</option>
                            <option value="4w">4W</option>
                            <option value="heavy">Heavy</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Manufacturing Year</label>
                        <input type="number" name="manufacturingYear" min="1900" max="2030" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" >
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Test Result</label>
                        <select name="testResult" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                            <option value="">Select Result</option>
                            <option value="pass">Pass</option>
                            <option value="fail">Fail</option>
                        </select>
                    </div>

                    <div id="reTestDateSection" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Re-Test Date</label>
                        <input type="date" name="reTestDate" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Mobile Number</label>
                        <input type="tel" name="mobileNumber" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" >
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" name="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" >
                    </div>

             <div>
    <label class="block text-sm font-medium text-gray-700 mb-2">State</label>
    <select name="state" id="stateSelect" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
        <option value="">Select State</option>
    </select>
</div>
<div class="mb-4">
    <label for="districtSelect" class="block text-sm font-medium text-gray-700 mb-2">District</label>
    <select id="districtSelect " name="district" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" disabled>
        <option value="">Select District</option>
    </select>
</div>
<script src="../southIndiaStatesAndDistricts.js"></script>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pollution Testing Center</label>
                        <select name="testingCenter" id="testingCenter" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                            <option value="">Select Center</option>
                            <option value="center1">Center 1 - Delhi</option>
                            <option value="center2">Center 2 - Mumbai</option>
                            <option value="center3">Center 3 - Bangalore</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pollution Officer Name</label>
                        <input type="text" name="officerName" id="officerName" readonly class="w-full px-4 py-3 bg-gray-100 border border-gray-300 rounded-lg text-gray-600">
                    </div>
                </div>

                <div class="flex justify-end pt-6">
                    <button id="SubmitButton" disabled type="submit" class="Button-disabled bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-8 rounded-lg transition-colors duration-200 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                        Submit Registration
                    </button>
                </div>
            </form>
        </div>
    </div>
    <script>
$(document).ready(function() {
    
    $('input[name="ownerName"]').focus();
$('#testingCenter').change(function() {
        const center = $(this).val();
        const officerNames = {
            center1: 'Rajesh Kumar',
            center2: 'Anita Singh',
            center3: 'Vikram Patel'
        };
        $('#officerName').val(officerNames[center] || '');
    });
    const populateStates = () => {
        const stateSelect = $("#stateSelect");
        southIndiaStatesAndDistricts.forEach(stateObj => 
            stateSelect.append($("<option>").val(stateObj.state).text(stateObj.state))
        );
    };

    const updateDistricts = () => {
        const stateSelect = $("#stateSelect");
        const districtSelect = $("#districtSelect");
        const selectedState = stateSelect.val();
        const stateObj = southIndiaStatesAndDistricts.find(state => state.state === selectedState);

        districtSelect.empty().append('<option value="">Select District</option>');
        districtSelect.prop('disabled', !selectedState);

        stateObj?.districts.forEach(district => 
            districtSelect.append($("<option>").val(district).text(district))
        );
    };

    const checkFormValidity = () => {
        let isValid = true;
        $('#emissionForm input, #emissionForm select').each(function() {
            const input = $(this);
            const name = input.attr('name');
            const value = input.val();
            const patterns = {
                vehicleNumber: /^[A-Z]{2}\d{2}[A-Z]{2}\d{4}$/,
                mobileNumber: /^[6-9]\d{9}$/,
                email: /^[^\s@]+@[^\s@]+\.[^\s@]+$/,
                ownerName: /^[a-zA-Z_]+$/
            };
            if (patterns[name] && !patterns[name].test(value)) isValid = false;
            if (name === 'manufacturingYear') {
                let yearValue = value.replace(/[^0-9]/g, '').slice(0, 4);
                $(this).val(yearValue);
                if (yearValue.length !== 4) isValid = false;
            }
            if (value === '') isValid = false;

            input.toggleClass('border-red-500', !isValid).toggleClass('border-green-500', isValid);
        });
        $('#SubmitButton').prop('disabled', !isValid).toggleClass('Button-disabled', !isValid);
    };

    populateStates();
    $("#stateSelect").on("change", updateDistricts);
    $('#emissionForm input, #emissionForm select').on('input blur change', checkFormValidity);

    $('select[name="testResult"]').change(function() {
        $('#reTestDateSection').toggleClass('hidden', $(this).val() !== 'fail');
        checkFormValidity();
    });

    $('#emissionForm').submit(function(e) {
        e.preventDefault();
        let isValid = true;
        $(this).find('input, select').each(function() {
            if (!$(this).val()) {
                $(this).addClass('border-red-500');
                isValid = false;
            } else {
                $(this).removeClass('border-red-500');
            }
        });
        alert(isValid ? 'Form submitted successfully!' : 'Please fill out all required fields.');
    });
   const moveToNextField = (currentField) => {
        let nextField = currentField.closest('form').querySelector('input:not([readonly]):not([disabled]), select:not([readonly]):not([disabled])');

        // Find the next field in the form
        while (nextField && nextField === currentField[0]) {
            nextField = currentField.closest('form').querySelector('input:not([readonly]):not([disabled]), select:not([readonly]):not([disabled])');
        }

        // If a next field is found, move the focus to it
        if (nextField) {
            nextField.focus();
        }
    };

    // Listen for the keypress event on all form fields
    $('#emissionForm input, #emissionForm select').on('keypress', function(e) {
        if (e.which === 13) {  // Enter key pressed
            e.preventDefault(); // Prevent form submission
            
            const currentField = $(this);
            moveToNextField(currentField);  // Move to the next field
        }
    });
$('input[name="ownerName"]').on('keypress', function(e) {
    // Allow backspace, delete, tab, and other control keys
    if (e.which === 8 || e.which === 9 || e.which === 46 || e.which === 37 || e.which === 39) {
        return;
    }

    // Allow only alphabetic characters (A-Z and a-z)
    if (!/[a-zA-Z]/.test(String.fromCharCode(e.which))) {
        e.preventDefault();  // Prevent non-alphabetic characters
    }
});
$('input[name="mobileNumber"]').on('input', function() {
    const mobileField = $(this);
    const value = mobileField.val();

    // If the length exceeds 10 digits, trim the input to 10 digits
    if (value.length > 10) {
        mobileField.val(value.slice(0, 10));  // Limit input to 10 characters
    }
});

    const checkFieldValidity = (field) => {
        const value = field.val();
        const name = field.attr('name');
        const patterns = {
            vehicleNumber: /^[A-Z]{2}\d{2}[A-Z]{2}\d{4}$/,
            mobileNumber: /^\d{10}$/,
            email: /^[^\s@]+@[^\s@]+\.[^\s@]+$/,
            ownerName: /^[a-zA-Z_]+$/,
            manufacturingYear: /^\d{4}$/,
            registrationDate: /.+/,
            fuelType: /.+/,
            vehicleType: /.+/,
            testResult: /.+/
        };
        return patterns[name]?.test(value) ?? value !== '';
    };
});
    </script>
</body>
</html>